@echo off

color 0A

:: BatchGotAdmin
:-------------------------------------
:: Check for permissions
>nul 2>&1 "%SYSTEMROOT%\system32\cacls.exe" "%SYSTEMROOT%\system32\config\system"

:: If error flag set, we do not have admin.
if '%errorlevel%' NEQ '0' (
    echo Requesting administrative privileges...
    goto UACPrompt
) else ( goto gotAdmin )

:UACPrompt
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"
    set params = %*:"=""
    echo UAC.ShellExecute "cmd.exe", "/c %~s0 %params%", "", "runas", 1 >> "%temp%\getadmin.vbs"

    "%temp%\getadmin.vbs"
    del "%temp%\getadmin.vbs"
    exit /B

:gotAdmin
    pushd "%CD%"
    CD /D "%~dp0"
:--------------------------------------

choice /m "Is This Windows Server? (check readme while using the script to make sure everything is ok)"
if Errorlevel 2 goto NoWindowsServer
if Errorlevel 1 goto YesWindowsServer

:NoWindowsServer

goto EndWindowsServer

::----------------------------------------------------Windows Server-------------------------------------------------------

:YesWindowsServer

:: -------------------------------------Local Security Policy-------------------------------------

:: Password and Logon Policy

choice /m "Update Logon and Password Policy?"
if Errorlevel 2 goto NoPasswordPolicy
if Errorlevel 1 goto YesPasswordPolicy

:NoPasswordPolicy

goto EndPasswordPolicy

:YesPasswordPolicy

echo Updating Password Policy...

net accounts /uniquepw:5
net accounts /minpwlen:14
net accounts /maxpwage:90
net accounts /minpwage:10

echo Exporting and updating Security Policy settings...

secedit.exe /export /cfg C:\secconfig.cfg

powershell -Command "(gc C:\secconfig.cfg) -replace 'PasswordComplexity = 0', 'PasswordComplexity = 1' | Out-File -encoding ASCII C:\secconfigupdated.cfg"
powershell -Command "(gc C:\secconfig.cfg) -replace 'DontDisplayLastUserName=4,0', 'DontDisplayLastUserName=4,1' | Out-File -encoding ASCII C:\secconfigupdated.cfg"
powershell -Command "(gc C:\secconfig.cfg) -replace 'LimitBlankPasswordUse=4,0', 'LimitBlankPasswordUse=4,1' | Out-File -encoding ASCII C:\secconfigupdated.cfg"

echo Security Policy updates completed...
echo Importing Security Policy Settings...

secedit.exe /configure /db %windir%\securitynew.sdb /cfg C:\secconfigupdated.cfg /areas SECURITYPOLICY

echo Import successful...

del c:\secconfig.cfg
del c:\secconfigupdated.cfg

:EndPasswordPolicy

:: Lockout Policy

choice /m "Update Lockout Policy?"
if Errorlevel 2 goto NoLockoutPolicy
if Errorlevel 1 goto YesLockoutPolicy

:NoLockoutPolicy

goto EndLockoutPolicy

:YesLockoutPolicy

echo Updating Account Lockout Policy...

net accounts /lockoutduration:30
net accounts /lockoutthreshold:5
net accounts /lockoutwindow:30

:EndLockoutPolicy

:: Audit Policy

choice /m "Update Audit Policy?"
if Errorlevel 2 goto NoAuditPolicy
if Errorlevel 1 goto YesAuditPolicy

:NoAuditPolicy

goto EndAuditPolicy

:YesAuditPolicy

echo Updating Audit Policies...

Auditpol /set /category:"Account Logon" /success:enable /failure:enable
Auditpol /set /category:"Account Management" /success:enable /failure:enable
Auditpol /set /category:"Detailed Tracking" /success:enable /failure:enable
Auditpol /set /category:"DS Access" /success:enable /failure:enable
Auditpol /set /category:"Logon/Logoff" /Success:enable /failure:enable
Auditpol /set /category:"Object Access" /success:enable /failure:enable
Auditpol /set /category:"Policy Change" /success:enable /failure:enable
Auditpol /set /category:"Privilege Use" /success:enable /failure:enable
Auditpol /set /category:"System" /success:enable /failure:enable

:EndAuditPolicy

:: Firewall Policy

choice /m "Enable Firewall?"
if Errorlevel 2 goto NoConfigureFirewall
if Errorlevel 1 goto YesConfigureFirewall

:NoConfigureFirewall

goto EndConfigureFirewall

:YesConfigureFirewall

echo Configuring Firewall...

netsh advfirewall set allprofiles state on

:EndConfigureFirewall

:: ---------------------------------------lusrmgr Settings-------------------------------------

:: Default Accounts

choice /m "Disable and Rename Default Guest Account?"
if Errorlevel 2 goto NoGuestAccount
if Errorlevel 1 goto YesGuestAccount

:NoGuestAccount

goto EndGuestAccount

:YesGuestAccount

net user guest /active:no
wmic useraccount where name='Guest' rename 'Potato'

:EndGuestAccount

choice /m "Disable and Rename Default Administrator Account?"
if Errorlevel 2 goto NoAdminAccount
if Errorlevel 1 goto YesAdminAccount

:NoAdminAccount

goto EndAdminAccount

:YesAdminAccount

net user Administrator /active:no
wmic useraccount where name='Administrator' rename 'Tomato'

:EndAdminAccount

choice /m "Change All User Passwords?"
if Errorlevel 2 goto NoChangePassword
if Errorlevel 1 goto YesChangePassword

:NoChangePassword

goto EndChangePassword

:YesChangePassword

FOR /F %%F IN ('wmic useraccount get name') DO (Echo "%%F" | FIND /I "Name" 1>NUL) || (Echo "%%F" | FIND /I "DefaultAccount" 1>NUL) || (NET USER %%F j273e4*KeH49kDW)

:EndChangePassword

:: ----------------------------------------Services-------------------------------------

choice /m "Disable World Wide Web Publishing Service?"
if Errorlevel 2 goto NoWWPS
if Errorlevel 1 goto YesWWPS

:NoWWPS

goto EndWWPS

:YesWWPS

sc config w3svc start=disabled
sc stop w3svc

:EndWWPS

choice /m "Make EventLog Automatic?"
if Errorlevel 2 goto NoEventLog
if Errorlevel 1 goto YesEventLog

:NoEventLog

goto EndEventLog

:YesEventLog

sc config eventlog start=auto
net start eventlog

:EndEventLog

choice /m "Disable Remote Desktop, RDP, and Remote Registry Services?"
if Errorlevel 2 goto NoRemoteDesktop
if Errorlevel 1 goto YesRemoteDesktop

:NoRemoteDesktop

goto EndRemoteDesktop

:YesRemoteDesktop

net stop TermService
sc config "TermService" start=disabled
net stop RemoteRegistry
sc config "RemoteRegistry" start=disabled
net stop UmRdpService
sc config "UmRdpService" start= disabled
sc stop RemoteAccess
sc config "RemoteAccess" start= disabled

:EndRemoteDesktop

:: ----------------------------------------Other Settings---------------------------------

choice /m "Delete .mp3, .mp4, and .mov files?"
if Errorlevel 2 goto EndMediaFiles
if Errorlevel 1 goto EndMediaFiles

:NoMediaFiles

goto EndMediaFiles

:YesMediaFiles

del /S /Q *.mp3
del /S /Q *.mp4
del /S /Q *.mov

:EndMediaFiles

choice /m "Clean Host File?"
if Errorlevel 2 goto NoHostFile
if Errorlevel 1 goto YesHostFile

:NoHostFile

goto EndHostFile

:YesHostFile

copy %WinDir%\System32\drivers\etc\hosts %WinDir%\System32\drivers\etc\hosts.old
break > %WinDir%\System32\drivers\etc\hosts

:EndHostFile

choice /m "Turn Off Sharing?"
if Errorlevel 2 goto NoSharing
if Errorlevel 1 goto YesSharing

:NoSharing

goto EndSharing

:YesSharing

net share C:\ /delete

:EndSharing

choice /m "Turn Off Certain Features (Check ReadMe) (takes a long time or is broken?)?"
if Errorlevel 2 goto NoServices
if Errorlevel 1 goto YesServices

:NoServices

goto EndServices

:YesServices

DISM /online /disable-feature /featurename:TelnetClient
DISM /online /disable-feature /featurename:TelnetServer
DISM /online /disable-feature /featurename:TFTP
DISM /online /disable-feature /featurename:SNMP
DISM /online /disable-feature /featurename:SMB

:EndServices

:: ---------------------------------------Windows Settings-------------------------------------

choice /m "Update Windows?"
if Errorlevel 2 goto NoUpdateWindows
if Errorlevel 1 goto YesUpdateWindows

:NoUpdateWindows

goto EndUpdateWindows

:YesUpdateWindows

start ms-settings:

:EndUpdateWindows

goto EndBatchScript

:: ------------------------------------------------------------Windows 10---------------------------------------------------------

:EndWindowsServer

:: -------------------------------------Local Security Policy-------------------------------------

:: Password and Logon Policy

choice /m "Update Logon and Password Policy?"
if Errorlevel 2 goto NoPasswordPolicy1
if Errorlevel 1 goto YesPasswordPolicy1

:NoPasswordPolicy1

goto EndPasswordPolicy1

:YesPasswordPolicy1

echo Updating Password Policy...

net accounts /uniquepw:5
net accounts /minpwlen:14
net accounts /maxpwage:90
net accounts /minpwage:10

echo Exporting and updating Security Policy settings...

secedit.exe /export /cfg C:\secconfig.cfg

powershell -Command "(gc C:\secconfig.cfg) -replace 'PasswordComplexity = 0', 'PasswordComplexity = 1' | Out-File -encoding ASCII C:\secconfigupdated.cfg"
powershell -Command "(gc C:\secconfig.cfg) -replace 'DontDisplayLastUserName=4,0', 'DontDisplayLastUserName=4,1' | Out-File -encoding ASCII C:\secconfigupdated.cfg"
powershell -Command "(gc C:\secconfig.cfg) -replace 'LimitBlankPasswordUse=4,0', 'LimitBlankPasswordUse=4,1' | Out-File -encoding ASCII C:\secconfigupdated.cfg"

echo Security Policy updates completed...
echo Importing Security Policy Settings...

secedit.exe /configure /db %windir%\securitynew.sdb /cfg C:\secconfigupdated.cfg /areas SECURITYPOLICY

echo Import successful...

del c:\secconfig.cfg
del c:\secconfigupdated.cfg

:EndPasswordPolicy1

:: Lockout Policy

choice /m "Update Lockout Policy?"
if Errorlevel 2 goto NoLockoutPolicy1
if Errorlevel 1 goto YesLockoutPolicy1

:NoLockoutPolicy1

goto EndLockoutPolicy1

:YesLockoutPolicy1

echo Updating Account Lockout Policy...

net accounts /lockoutduration:30
net accounts /lockoutthreshold:5
net accounts /lockoutwindow:30

:EndLockoutPolicy1

:: Audit Policy

choice /m "Update Audit Policy?"
if Errorlevel 2 goto NoAuditPolicy1
if Errorlevel 1 goto YesAuditPolicy1

:NoAuditPolicy1

goto EndAuditPolicy1

:YesAuditPolicy1

echo Updating Audit Policies...

Auditpol /set /category:"Account Logon" /success:enable /failure:enable
Auditpol /set /category:"Account Management" /success:enable /failure:enable
Auditpol /set /category:"Detailed Tracking" /success:enable /failure:enable
Auditpol /set /category:"DS Access" /success:enable /failure:enable
Auditpol /set /category:"Logon/Logoff" /Success:enable /failure:enable
Auditpol /set /category:"Object Access" /success:enable /failure:enable
Auditpol /set /category:"Policy Change" /success:enable /failure:enable
Auditpol /set /category:"Privilege Use" /success:enable /failure:enable
Auditpol /set /category:"System" /success:enable /failure:enable

:EndAuditPolicy1

:: Firewall Policy

choice /m "Enable Firewall?"
if Errorlevel 2 goto NoConfigureFirewall1
if Errorlevel 1 goto YesConfigureFirewall1

:NoConfigureFirewall1

goto EndConfigureFirewall1

:YesConfigureFirewall1

echo Configuring Firewall...

netsh advfirewall set allprofiles state on

:EndConfigureFirewall1

:: ---------------------------------------lusrmgr Settings-------------------------------------

:: Default Accounts

choice /m "Disable and Rename Default Guest Account?"
if Errorlevel 2 goto NoGuestAccount1
if Errorlevel 1 goto YesGuestAccount1

:NoGuestAccount1

goto EndGuestAccount1

:YesGuestAccount1

net user guest /active:no
wmic useraccount where name='Guest' rename 'Potato'

:EndGuestAccount1

choice /m "Disable and Rename Default Administrator Account?"
if Errorlevel 2 goto NoAdminAccount1
if Errorlevel 1 goto YesAdminAccount1

:NoAdminAccount1

goto EndAdminAccount1

:YesAdminAccount1

net user Administrator /active:no
wmic useraccount where name='Administrator' rename 'Tomato'

:EndAdminAccount1

choice /m "Change All User Passwords?"
if Errorlevel 2 goto NoChangePassword1
if Errorlevel 1 goto YesChangePassword1

:NoChangePassword1

goto EndChangePassword1

:YesChangePassword1

FOR /F %%F IN ('wmic useraccount get name') DO (Echo "%%F" | FIND /I "Name" 1>NUL) || (Echo "%%F" | FIND /I "DefaultAccount" 1>NUL) || (NET USER %%F j273e4*KeH49kDW)

:EndChangePassword1

:: ----------------------------------------Services-------------------------------------

choice /m "Disable Remote Desktop, RDP, and Remote Registry Services?"
if Errorlevel 2 goto NoRemoteDesktop1
if Errorlevel 1 goto YesRemoteDesktop1

:NoRemoteDesktop1

goto EndRemoteDesktop1

:YesRemoteDesktop1

net stop TermService
sc config "TermService" start=disabled
net stop RemoteRegistry
sc config "RemoteRegistry" start=disabled
sc stop UmRdpService
sc config "UmRdpService" start= disabled
sc stop RemoteAccess
sc config "RemoteAccess" start= disabled

:EndRemoteDesktop1

:: ----------------------------------------Other Settings---------------------------------

choice /m "Delete .mp3, .mp4, and .mov files (dont)?"
if Errorlevel 2 goto EndMediaFiles1
if Errorlevel 1 goto EndMediaFiles1

:NoMediaFiles1

goto EndMediaFiles1

:YesMediaFiles1

del /S /Q *.mp3
del /S /Q *.mp4
del /S /Q *.mov

:EndMediaFiles1

choice /m "Turn Off Sharing?"
if Errorlevel 2 goto NoSharing1
if Errorlevel 1 goto YesSharing1

:NoSharing1

goto EndSharing1

:YesSharing1

net share C:\ /delete

:EndSharing1

choice /m "Clean Host File?"
if Errorlevel 2 goto NoHostFileClean
if Errorlevel 1 goto YesHostFileClean

:NoHostFileClean

goto EndHostFileClean

:YesHostFileClean

copy %WinDir%\System32\drivers\etc\hosts %WinDir%\System32\drivers\etc\hosts.old
break > %WinDir%\System32\drivers\etc\hosts

:EndHostFileClean

choice /m "Turn Off Certain Features (Check ReadMe) (takes a long time or is broken?)?"
if Errorlevel 2 goto NoServices
if Errorlevel 1 goto YesServices

:NoServices

goto EndServices

:YesServices

DISM /online /disable-feature /featurename:TelnetClient
DISM /online /disable-feature /featurename:TelnetServer
DISM /online /disable-feature /featurename:TFTP
DISM /online /disable-feature /featurename:SNMP
DISM /online /disable-feature /featurename:SMB

:EndServices

choice /m "Block All Microsoft Accounts?"
if Errorlevel 2 goto NoBlockMicrosoftAccounts
if Errorlevel 1 goto YesBlockMicrosoftAccounts

:NoBlockMicrosoftAccounts

goto EndBlockMicrosoftAccounts

:YesBlockMicrosoftAccounts

REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v NoConnectedUser /t REG_DWORD /d 3 /f

:EndBlockMicrosoftAccounts

:: ---------------------------------------Windows Settings-------------------------------------

choice /m "Update Windows?"
if Errorlevel 2 goto NoUpdateWindows
if Errorlevel 1 goto YesUpdateWindows

:NoUpdateWindows

goto EndUpdateWindows

:YesUpdateWindows

start ms-settings:

:EndUpdateWindows

goto EndBatchScript

:: ---------------------------------------------------------End of Batch Script---------------------------------------------------

:EndBatchScript

pause
